import os
import time

class TimeForLiteralStack():
    def __init__(self, timeV = 0.0):
        self.time = timeV
    
    def getTime(self):
        return self.time


class WordForLiteralStack():
    def __init__(self, word = ''):
        self.word = word
    
    def getWord(self):
        return self.word
    

class PySpeechServer:
    def __init__(self):
        # literalStack = [word(), delay(), word(), delay()]
        self.literalStack = []
        # sentenceDictionary = ['Hello boy', 'Hello girl', ...]
        self.sentenceDictionary = []
        # callbackUrls = { 'Hello boy': ['http://...', 'http://...', ...], '...': [], ...}
        self.callbackUrls = {}
        
        self.lastWordAdded = ''
        self.lastWordTimestamp = time.time()
    
    '''
    arrSentences = ['Hello boy', 'Hello girl', ...]
    '''
    def addSentenceDictionary(self, arrSentences):
        for val in arrSentences:
            self.sentenceDictionary.append(val)
            callbackUrls[val] = []
    
    '''
    sentenceToCallbackUrlsMap = [{sentence: 'Hello boy', url: 'http://...'}, {...}, ...]
    '''
    def fillCallbackUrls(self, sentenceToCallbackUrlsMap):
        for el in sentenceToCallbackUrlsMap:
            if el['sentence'] not in self.callbackUrls:
                self.sentenceDictionary.append(el['sentence'])
                self.callbackUrls[el['sentence']] = []
            self.callbackUrls[el['sentence']].append(el['url'])
    
    def addWordToStack(self, word):
        currentTime = time.time()
        timeDiff = currentTime - self.lastWordTimestamp
        
        # The time difference threshold
        if timeDiff > 7:
            self.literalStack = []
        elif timeDiff > 2:
            self.literalStack.append(TimeForLiteralStack(timeDiff))
    
        self.literalStack.append(WordForLiteralStack(word))
    
    def pollEvent(self):
        result = ['url1', 'url2']
        
        for val in self.literalStack:
            if type(val) is WordForLiteralStack:
                pass
            elif type(val) is TimeForLiteralStack:
                pass
        
        return result
    

if __name__ == '__main__':
    speechServer = PySpeechServer()
    speechServer.fillCallbackUrls([
        {
            'sentence': 'Hello boy',
            'url': 'http://google.co.in'
        },
        {
            'sentence': 'Hello girl',
            'url': 'http://soc.in'
        },
        {
            'sentence': 'Hello girl',
            'url': 'http://google.co.in/hd'
        }
    ])
    speechServer.addWordToStack('Hello')
    time.sleep(3)
    speechServer.addWordToStack('girl')
    time.sleep(1)
    
    ret = speechServer.pollEvent()
    print(ret)
    